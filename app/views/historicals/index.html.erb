<h1 class="mt-3 mb-4">Historial de Escaneo</h1>

<% if @historicals.any? %>
  <div class="row">
    <% @historicals.each do |historical| %>
      <div class="col-12 mb-3">
        <div class="card-historical shadow-sm rounded">
          <div class="card-historical-body d-flex align-items-center">
            <!-- Placeholder for product image -->
            <div class="me-3">
              <% if historical.product.photos.attached? %>
                <%= cl_image_tag(historical.product.photos[0].key, width: 70, height: 70, crop: :fill, class: "rounded") %>
              <% else %>
                <i class="fas fa-image fa-2x text-muted"></i> <!-- Show icon if no image -->
              <% end %>
            </div>

            <!-- Product information -->
            <div class="flex-grow-1">
              <h5 class="card-historical-title mb-1"><%= historical.product.name.truncate(30) %></h5>
              <p class="card-historical-text text-muted mb-2"><%= historical.product.brand %></p>
              <p class="card-historical-text mb-1">
                <% if historical.results %>
                  <span class="text-success">
                    <i class="fas fa-thumbs-up"></i> <strong>Producto APTO para consumo</strong>
                  </span>
                <% else %>
                  <span class="text-danger">
                    <i class="fas fa-thumbs-down"></i> <strong>Producto NO APTO para consumo</strong>
                  </span>
                <% end %>
              </p>
              <p class="text-muted small">
                <%= time_ago_in_words(historical.created_at) %> ago
              </p>
            </div>

            <!-- Dots menu -->
            <div class="text-muted">
              <i class="fas fa-ellipsis-v"></i>
            </div>

            <!-- Link that covers the entire card-historical -->
            <a href="<%= user_profile_historical_path(@user, @profile, historical) %>" class="stretched-link"></a>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="alert alert-warning" role="alert">
    No hay historiales para mostrar.
  </div>
<% end %>

<%= link_to 'Volver al perfil', user_profile_path(@user, @profile), class: "btn btn-secondary mt-3" %>
