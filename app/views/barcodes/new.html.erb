
<div class = "container mt-1 text-justify product-background align-baseline" id="new-page" style="max-width: 70%;">
  <div class="text-overlay">
    <h1 class="product-title mb-4 fw-bold"><strong>Nueva Consulta de Producto</strong></h1>
    <div class="instructions">
      <h2>Instrucciones: </h2>
      <div>
        <p> <strong>Toma una foto al código de barras del alimnento que deseas verificar como apto para tu consumo</strong>
      </div>
      </p>
      <div class="image-container">
        <%# <%= image_tag "scanner.png", alt: "scanner", class: "img-barcode" %>
        <div id="lottie-container" style="margin: auto;" ></div>
      </div>
    </div>
    <div class="form">
      <%= simple_form_for [@user, @profile, @barcode],
                                                html: {
                                                  id: "photo-form",
                                                  } do |f| %>
        <div class="custom-file">
          <%= f.input :photo, as: :file,  input_html: {
                                                    class: "custom-file-input",
                                                    id: "file-input",
                                                    onchange: "showLoaderAndSubmit();",
                                                    style: "display: none;"}, label: false  %>
          <label for="file-input" class="custom-file-btn">Escanear</label>
        </div>
      <% end %>
    </div>
  </div>
  <div>
    <%= link_to "Volver a Mi Perfil", user_profile_path(@user, @profile), class: "btn btn-primary mt-3" %>
  </div>
</div>
<div id= "load-msg" style = "margin: auto; display: none;" class="container d-flex justify-content-center mt-5 text-justify mt-2 align-middle">
  <h3 class= "loading-text">Estamos analizando tu producto, solo tomará unos segundos.</h3>
  <div id="loader" class="loader" style="display: none;" ></div>
</div>

<script>
  // function showLoaderAndSubmit() {
  //   // Mostrar el loader
  //   document.getElementById('loader').style.display = 'block';

  //   // Enviar el formulario
  //   document.getElementById('photo-form').submit();
  // }

document.addEventListener("DOMContentLoaded", function() {
    const container = document.getElementById('lottie-container');
    lottie.loadAnimation({
      container: container, // the DOM element to render the animation in
      renderer: 'svg',
      loop: true,
      autoplay: true,
      path: '<%= asset_path("/animations/scan_barcode.json") %>' // the path to your animation file
    });
  });
  function showLoaderAndSubmit() {
    // document.getElementById("new-page").style.display = 'none';
    document.getElementById("new-page").setAttribute("hidden", "hidden");

    // Mostrar el loader
    // document.getElementById('loading').style.position = 'relative';
    document.getElementById('loader').style.display = 'block';
    document.getElementById('load-msg').style.display = 'block'

    // Enviar el formulario
    document.getElementById('photo-form').submit();
  }

</script>
